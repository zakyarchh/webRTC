<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKAZ Live - Admin Panel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Login Panel -->
        <div id="loginPanel" class="login-panel glass-card fade-in">
            <div class="login-header">
                <span class="login-icon">ü§ôüòú</span>
                <h1>admin nieh boss ga udah sok jadi admin kalau lu ga tau email sama pw admin üòùüëä</h1>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="glass-input" placeholder="kalau ga tau jangan di isi ya ganteng/cantik" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="glass-input" placeholder="üòùüëä INI JUGA GA USAH SOK PENGEN JADI ADMIN" required>
                </div>
                <button type="submit" class="btn-primary btn-full">
                    üëä Masuk
                </button>
                <p id="loginError" class="error-text hidden"></p>
            </form>
            <a href="index.html" class="back-link">‚Üê Kembali ke Home</a>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="admin-dashboard hidden">
            <header class="admin-header glass-header slide-in-blurred-top">
                <div class="admin-title">
                    <span>ü§üüòùü§ìüëä </span>
                    <h1>Admin Panel</h1>
                </div>
                <div class="admin-actions">
                    <span id="adminEmail" class="admin-email"></span>
                    <button class="btn-secondary" onclick="logout()">üóøKELUAR ANJINGG</button>
                </div>
            </header>

            <main class="admin-main">
                <!-- Stream Control -->
                <section class="admin-card glass-card slide-in-blurred-top" id="streamControl">
                    <div class="card-header">
                        <h2>üé¨ Kontrol Streaming</h2>
                        <span id="streamStatus" class="stream-badge offline">OFFLINE</span>
                    </div>
                    <div class="card-body">
                        <div class="stream-settings">
                            <div class="input-group">
                                <label>Judul Streaming</label>
                                <input type="text" id="streamTitle" class="glass-input" placeholder="Judul live streaming...">
                            </div>
                            <div class="input-group">
                                <label>Jadwal</label>
                                <input type="text" id="streamSchedule" class="glass-input" placeholder="Contoh: Setiap Senin, 20:00 WIB">
                            </div>
                        </div>
                        <div class="stream-buttons">
                            <button id="startStreamBtn" class="btn-success btn-large" onclick="startStream()">
                                üëäMulai Live
                            </button>
                            <button id="stopStreamBtn" class="btn-danger btn-large hidden" onclick="stopStream()">
                                üòù Hentikan Live
                            </button>
                        </div>
                        <div id="previewContainer" class="preview-container hidden">
                            <video id="previewVideo" autoplay muted playsinline></video>
                            <p class="preview-label">Preview Stream</p>
                        </div>
                    </div>
                </section>

                <!-- Viewer Management -->
                <section class="admin-card glass-card slide-in-blurred-top delay-1">
                    <div class="card-header">
                        <h2>üë• Penonton</h2>
                        <span id="viewerCount" class="viewer-count">0</span>
                    </div>
                    <div class="card-body">
                        <div id="viewerList" class="viewer-list">
                            <p class="no-viewers">Belum ada penonton</p>
                        </div>
                    </div>
                </section>

                <!-- Token Management -->
                <section class="admin-card glass-card slide-in-blurred-top delay-2">
                    <div class="card-header">
                        <h2>üé´ Generate Token</h2>
                    </div>
                    <div class="card-body">
                        <div class="token-generator">
                            <div class="input-group">
                                <label>Masa Berlaku (Jam)</label>
                                <input type="number" id="tokenExpiry" class="glass-input" value="24" min="1" max="720">
                            </div>
                            <button class="btn-primary" onclick="generateToken()">
                                üé≤ Generate Token
                            </button>
                        </div>
                        <div id="generatedToken" class="generated-token hidden">
                            <p class="token-label">Token Baru:</p>
                            <div class="token-display">
                                <code id="tokenCode"></code>
                                <button class="btn-copy" onclick="copyToken()">üìã</button>
                            </div>
                        </div>
                        <div id="tokenList" class="token-list">
                            <h3>Token Aktif</h3>
                            <div id="activeTokens" class="active-tokens"></div>
                        </div>
                    </div>
                </section>

                <!-- Notification Sender -->
                <section class="admin-card glass-card slide-in-blurred-top delay-3">
                    <div class="card-header">
                        <h2>üì¢ Kirim Notifikasi</h2>
                    </div>
                    <div class="card-body">
                        <div class="notif-form">
                            <textarea id="notifMessage" class="glass-input" placeholder="Tulis pesan notifikasi..." rows="3"></textarea>
                            <button class="btn-primary" onclick="sendNotification()">
                                üì§ Kirim ke Semua
                            </button>
                        </div>
                        <p id="notifStatus" class="status-text hidden"></p>
                    </div>
                </section>

                <!-- Complaints -->
                <section class="admin-card glass-card slide-in-blurred-top delay-4">
                    <div class="card-header">
                        <h2>üì© Pengaduan</h2>
                        <span id="complaintCount" class="complaint-count">0</span>
                    </div>
                    <div class="card-body">
                        <div id="complaintList" class="complaint-list">
                            <p class="no-complaints">Tidak ada pengaduan</p>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Reply Modal -->
        <div id="replyModal" class="modal hidden">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h3>üí¨ Balas Pengaduan</h3>
                    <button class="modal-close" onclick="closeReplyModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="original-complaint">
                        <p id="originalComplaint"></p>
                    </div>
                    <textarea id="replyMessage" class="glass-input" placeholder="Tulis balasan..." rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeReplyModal()">Batal</button>
                    <button class="btn-primary" onclick="sendReply()">Kirim Balasan</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc, 
            deleteDoc,
            collection, 
            addDoc, 
            query, 
            where, 
            getDocs,
            onSnapshot,
            orderBy,
            serverTimestamp,
            Timestamp
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyABI8SWMoN_4YAtZa5hARAfYcMZ0jHfz1s",
            authDomain: "ikazlive.firebaseapp.com",
            projectId: "ikazlive",
            storageBucket: "ikazlive.firebasestorage.app",
            messagingSenderId: "1026492663745",
            appId: "1:1026492663745:web:41af1ff5662e9411481140",
            measurementId: "G-Y7SW5E6P1V"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // WebRTC Configuration
        const rtcConfig = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        let localStream = null;
        let peerConnections = {}; // viewerId -> RTCPeerConnection
        let isStreaming = false;
        let currentReplyComplaintId = null;
        let viewerListeners = [];

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user && user.email === 'ikaz@live.id') {
                showDashboard(user);
            } else {
                showLogin();
            }
        });

        function showLogin() {
            document.getElementById('loginPanel').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function showDashboard(user) {
            document.getElementById('loginPanel').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminEmail').textContent = user.email;
            
            initializeDashboard();
        }

        // Login handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');
            
            // Hardcoded credentials check
            if (email !== 'ikaz@live.id' || password !== '123321') {
                loginError.textContent = 'salah goblok anjing lu ngapain login admin emang lu siapa MEMEK';
                loginError.classList.remove('hidden');
                document.getElementById('loginPanel').classList.add('shake-horizontal');
                setTimeout(() => {
                    document.getElementById('loginPanel').classList.remove('shake-horizontal');
                }, 500);
                return;
            }
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                // If Firebase auth fails, still show error
                loginError.textContent = 'Login gagal jangan coba lagi: ' + error.message;
                loginError.classList.remove('hidden');
            }
        });

        // Logout
        window.logout = async function() {
            await stopStream();
            await signOut(auth);
        };
        
        

        // Initialize dashboard
        async function initializeDashboard() {
            // Load current stream settings
            const liveRef = doc(db, 'liveStream', 'current');
            const liveSnap = await getDoc(liveRef);
            
            if (liveSnap.exists()) {
                const data = liveSnap.data();
                document.getElementById('streamTitle').value = data.title || '';
                document.getElementById('streamSchedule').value = data.schedule || '';
                
                if (data.status === 'online') {
                    isStreaming = true;
                    updateStreamUI(true);
                }
            }
            
            // Listen to viewers
            listenToViewers();
            
            // Listen to complaints
            listenToComplaints();
            
            // Load active tokens
            loadActiveTokens();
        }

        // Start streaming
        window.startStream = async function() {
            try {
                const startBtn = document.getElementById('startStreamBtn');
                startBtn.disabled = true;
                startBtn.textContent = '‚è≥ Memulai...';
                
                // Get screen share with audio
                localStream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        cursor: 'always',
                        displaySurface: 'monitor'
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true
                    }
                });
                
                // Show preview
                const previewVideo = document.getElementById('previewVideo');
                previewVideo.srcObject = localStream;
                document.getElementById('previewContainer').classList.remove('hidden');
                
                // Handle stream end
                localStream.getVideoTracks()[0].addEventListener('ended', () => {
                    stopStream();
                });
                
                // Update Firestore
                const title = document.getElementById('streamTitle').value || 'IKAZ Live';
                const schedule = document.getElementById('streamSchedule').value || '';
                
                await setDoc(doc(db, 'liveStream', 'current'), {
                    status: 'online',
                    title: title,
                    schedule: schedule,
                    startedAt: serverTimestamp()
                });
                
                isStreaming = true;
                updateStreamUI(true);
                
                // Add heartbeat animation
                startBtn.classList.add('heartbeat');
                
            } catch (error) {
                console.error('Error starting stream:', error);
                alert('Gagal memulai streaming: ' + error.message);
                document.getElementById('startStreamBtn').disabled = false;
                document.getElementById('startStreamBtn').textContent = 'üëä Mulai Live';
            }
        };

        // Stop streaming
        window.stopStream = async function() {
            try {
                isStreaming = false;
                
                // Stop local stream
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                
                // Close all peer connections
                for (const viewerId in peerConnections) {
                    if (peerConnections[viewerId]) {
                        peerConnections[viewerId].close();
                    }
                }
                peerConnections = {};
                
                // Update Firestore - set offline
                await updateDoc(doc(db, 'liveStream', 'current'), {
                    status: 'offline'
                });
                
                // Delete all viewers
                const viewersRef = collection(db, 'viewers');
                const viewersSnap = await getDocs(viewersRef);
                const deletePromises = viewersSnap.docs.map(doc => deleteDoc(doc.ref));
                await Promise.all(deletePromises);
                
                // Delete all complaints (live ended)
                const complaintsRef = collection(db, 'complaints');
                const complaintsSnap = await getDocs(complaintsRef);
                const deleteComplaintsPromises = complaintsSnap.docs.map(doc => deleteDoc(doc.ref));
                await Promise.all(deleteComplaintsPromises);
                
                updateStreamUI(false);
                
                // Animation
                const stopBtn = document.getElementById('stopStreamBtn');
                stopBtn.classList.add('scale-out-center');
                
            } catch (error) {
                console.error('Error stopping stream:', error);
            }
        };

        function updateStreamUI(isLive) {
            const startBtn = document.getElementById('startStreamBtn');
            const stopBtn = document.getElementById('stopStreamBtn');
            const statusBadge = document.getElementById('streamStatus');
            const previewContainer = document.getElementById('previewContainer');
            
            if (isLive) {
                startBtn.classList.add('hidden');
                startBtn.classList.remove('heartbeat');
                stopBtn.classList.remove('hidden');
                stopBtn.classList.remove('scale-out-center');
                statusBadge.textContent = 'ONLINE';
                statusBadge.className = 'stream-badge online';
            } else {
                startBtn.classList.remove('hidden');
                startBtn.disabled = false;
                startBtn.textContent = 'üëä Mulai Live';
                stopBtn.classList.add('hidden');
                statusBadge.textContent = 'OFFLINE';
                statusBadge.className = 'stream-badge offline';
                previewContainer.classList.add('hidden');
            }
        }

        // Listen to viewers and create peer connections
        function listenToViewers() {
            const viewersRef = collection(db, 'viewers');
            
            onSnapshot(viewersRef, async (snapshot) => {
                const viewerList = document.getElementById('viewerList');
                const viewerCount = document.getElementById('viewerCount');
                
                if (snapshot.empty) {
                    viewerList.innerHTML = '<p class="no-viewers">Belum ada penonton</p>';
                    viewerCount.textContent = '0';
                    return;
                }
                
                viewerList.innerHTML = '';
                let count = 0;
                
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const viewerId = docSnap.id;
                    
                    count++;
                    
                    const viewerItem = document.createElement('div');
                    viewerItem.className = 'viewer-item glass-bubble';
                    viewerItem.innerHTML = `
                        <span class="viewer-icon">üë§</span>
                        <span class="viewer-name">${data.name || 'Anonymous'}</span>
                        <span class="viewer-status ${data.status}">${data.status}</span>
                        <button class="btn-small btn-danger" onclick="disconnectViewer('${viewerId}')">‚úï</button>
                    `;
                    viewerList.appendChild(viewerItem);
                    
                    // Handle new pending viewer
                    if (data.status === 'pending' && isStreaming && localStream) {
                        createOfferForViewer(viewerId);
                    }
                    
                    // Listen for answer from this viewer
                    if (!viewerListeners.includes(viewerId)) {
                        viewerListeners.push(viewerId);
                        listenForViewerAnswer(viewerId);
                    }
                });
                
                viewerCount.textContent = count.toString();
            });
        }

        // Create offer for a viewer
        async function createOfferForViewer(viewerId) {
            try {
                if (peerConnections[viewerId]) {
                    peerConnections[viewerId].close();
                }
                
                const pc = new RTCPeerConnection(rtcConfig);
                peerConnections[viewerId] = pc;
                
                // Add local stream tracks
                localStream.getTracks().forEach(track => {
                    pc.addTrack(track, localStream);
                });
                
                // ICE candidate handling
                pc.onicecandidate = async (event) => {
                    if (event.candidate) {
                        await addDoc(collection(db, 'viewers', viewerId, 'adminCandidates'), {
                            candidate: event.candidate.toJSON(),
                            createdAt: serverTimestamp()
                        });
                    }
                };
                
                // Listen for viewer's ICE candidates
                onSnapshot(collection(db, 'viewers', viewerId, 'viewerCandidates'), (snapshot) => {
                    snapshot.docChanges().forEach(async (change) => {
                        if (change.type === 'added') {
                            const data = change.doc.data();
                            if (pc.remoteDescription) {
                                try {
                                    await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
                                } catch (e) {
                                    console.error('Error adding ICE candidate:', e);
                                }
                            }
                        }
                    });
                });
                
                // Create offer
                const offer = await pc.createOffer();
                await pc.setLocalDescription(offer);
                
                // Save offer to Firestore
                await updateDoc(doc(db, 'viewers', viewerId), {
                    offer: {
                        type: offer.type,
                        sdp: offer.sdp
                    },
                    status: 'offered'
                });
                
                console.log('Offer created for viewer:', viewerId);
                
            } catch (error) {
                console.error('Error creating offer:', error);
            }
        }

        // Listen for viewer's answer
        function listenForViewerAnswer(viewerId) {
            const viewerRef = doc(db, 'viewers', viewerId);
            
            onSnapshot(viewerRef, async (docSnap) => {
                if (!docSnap.exists()) return;
                
                const data = docSnap.data();
                const pc = peerConnections[viewerId];
                
                if (data.answer && pc && !pc.currentRemoteDescription) {
                    try {
                        const answer = new RTCSessionDescription(data.answer);
                        await pc.setRemoteDescription(answer);
                        
                        // Update status
                        await updateDoc(viewerRef, {
                            status: 'connected'
                        });
                        
                        console.log('Answer received from viewer:', viewerId);
                    } catch (error) {
                        console.error('Error setting remote description:', error);
                    }
                }
            });
        }

        // Disconnect viewer
        window.disconnectViewer = async function(viewerId) {
            try {
                if (peerConnections[viewerId]) {
                    peerConnections[viewerId].close();
                    delete peerConnections[viewerId];
                }
                await deleteDoc(doc(db, 'viewers', viewerId));
            } catch (error) {
                console.error('Error disconnecting viewer:', error);
            }
        };

        // Generate token
        window.generateToken = async function() {
            try {
                const expiry = parseInt(document.getElementById('tokenExpiry').value) || 24;
                const token = generateRandomToken();
                
                const expiresAt = Timestamp.fromDate(
                    new Date(Date.now() + expiry * 60 * 60 * 1000)
                );
                
                await addDoc(collection(db, 'tokens'), {
                    token: token,
                    expiresAt: expiresAt,
                    createdAt: serverTimestamp()
                });
                
                // Show generated token
                document.getElementById('tokenCode').textContent = token;
                document.getElementById('generatedToken').classList.remove('hidden');
                document.getElementById('generatedToken').classList.add('fade-in');
                
                // Reload token list
                loadActiveTokens();
                
            } catch (error) {
                console.error('Error generating token:', error);
                alert('Gagal generate token');
            }
        };

        function generateRandomToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let token = '';
            for (let i = 0; i < 8; i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return token;
        }

        // Copy token
        window.copyToken = function() {
            const token = document.getElementById('tokenCode').textContent;
            navigator.clipboard.writeText(token);
            alert('Token disalin!');
        };

        // Load active tokens
        async function loadActiveTokens() {
            try {
                const tokensRef = collection(db, 'tokens');
                const now = Timestamp.now();
                const q = query(tokensRef, where('expiresAt', '>', now));
                const snapshot = await getDocs(q);
                
                const container = document.getElementById('activeTokens');
                
                if (snapshot.empty) {
                    container.innerHTML = '<p class="no-tokens">Tidak ada token aktif</p>';
                    return;
                }
                
                container.innerHTML = '';
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const expiry = data.expiresAt.toDate().toLocaleString('id-ID');
                    
                    const tokenItem = document.createElement('div');
                    tokenItem.className = 'token-item glass-bubble';
                    tokenItem.innerHTML = `
                        <code>${data.token}</code>
                        <span class="token-expiry">Exp: ${expiry}</span>
                        <button class="btn-small btn-danger" onclick="deleteToken('${docSnap.id}')">üóëÔ∏è</button>
                    `;
                    container.appendChild(tokenItem);
                });
            } catch (error) {
                console.error('Error loading tokens:', error);
            }
        }

        // Delete token
        window.deleteToken = async function(tokenId) {
            try {
                await deleteDoc(doc(db, 'tokens', tokenId));
                loadActiveTokens();
            } catch (error) {
                console.error('Error deleting token:', error);
            }
        };

        // Send notification
        window.sendNotification = async function() {
            const message = document.getElementById('notifMessage').value.trim();
            const status = document.getElementById('notifStatus');
            
            if (!message) {
                status.textContent = 'Tulis pesan terlebih dahulu';
                status.className = 'status-text error';
                status.classList.remove('hidden');
                return;
            }
            
            try {
                await addDoc(collection(db, 'notifications'), {
                    message: message,
                    createdAt: serverTimestamp()
                });
                
                document.getElementById('notifMessage').value = '';
                status.textContent = '‚úÖ Notifikasi terkirim!';
                status.className = 'status-text success jello-horizontal';
                status.classList.remove('hidden');
                
                setTimeout(() => {
                    status.classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('Error sending notification:', error);
                status.textContent = 'Gagal mengirim notifikasi';
                status.className = 'status-text error';
                status.classList.remove('hidden');
            }
        };

        // Listen to complaints
        function listenToComplaints() {
            const complaintsRef = collection(db, 'complaints');
            const q = query(complaintsRef, orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const complaintList = document.getElementById('complaintList');
                const complaintCount = document.getElementById('complaintCount');
                
                if (snapshot.empty) {
                    complaintList.innerHTML = '<p class="no-complaints">Tidak ada pengaduan</p>';
                    complaintCount.textContent = '0';
                    return;
                }
                
                complaintList.innerHTML = '';
                complaintCount.textContent = snapshot.size.toString();
                
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const time = data.createdAt?.toDate?.() || new Date();
                    const timeStr = time.toLocaleTimeString('id-ID');
                    
                    const complaintItem = document.createElement('div');
                    complaintItem.className = 'complaint-item glass-bubble slide-in-right';
                    complaintItem.innerHTML = `
                        <div class="complaint-header">
                            <span class="complaint-sender">üë§ ${data.viewerName || 'Anonymous'}</span>
                            <span class="complaint-time">${timeStr}</span>
                        </div>
                        <p class="complaint-message">${data.message}</p>
                        ${data.reply ? `<p class="complaint-reply">‚Ü™Ô∏è ${data.reply}</p>` : ''}
                        <div class="complaint-actions">
                            ${!data.reply ? `<button class="btn-small btn-primary" onclick="openReplyModal('${docSnap.id}', '${data.message.replace(/'/g, "\\'")}')">üí¨ Balas</button>` : ''}
                            <button class="btn-small btn-danger" onclick="deleteComplaint('${docSnap.id}')">üóëÔ∏è</button>
                        </div>
                    `;
                    complaintList.appendChild(complaintItem);
                });
            });
        }

        // Reply modal functions
        window.openReplyModal = function(complaintId, message) {
            currentReplyComplaintId = complaintId;
            document.getElementById('originalComplaint').textContent = message;
            document.getElementById('replyModal').classList.remove('hidden');
        };

        window.closeReplyModal = function() {
            currentReplyComplaintId = null;
            document.getElementById('replyModal').classList.add('hidden');
            document.getElementById('replyMessage').value = '';
        };

        window.sendReply = async function() {
            const reply = document.getElementById('replyMessage').value.trim();
            
            if (!reply || !currentReplyComplaintId) return;
            
            try {
                await updateDoc(doc(db, 'complaints', currentReplyComplaintId), {
                    reply: reply
                });
                closeReplyModal();
            } catch (error) {
                console.error('Error sending reply:', error);
                alert('Gagal mengirim balasan');
            }
        };

        // Delete complaint
        window.deleteComplaint = async function(complaintId) {
            try {
                await deleteDoc(doc(db, 'complaints', complaintId));
            } catch (error) {
                console.error('Error deleting complaint:', error);
            }
        };
    </script>
</body>
</html>